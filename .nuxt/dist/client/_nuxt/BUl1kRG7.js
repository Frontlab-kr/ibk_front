import{t as e,U as t,w as s,p as n,j as o,k as r,L as c}from"./Dw9mMgGh.js";import{u as a}from"./KdrZNi80.js";import{u as i}from"./BA3wzVCz.js";import{e as d}from"./BOhWGRxD.js";import{C as u,w as l}from"./BL-uwq_y.js";function L(){const s=a(),n=i(),o=u((()=>{const e=s.chapterLesson?.courseDegreeInfo;return e?{vodCnt:e.vodCnt||0,examCnt:e.examCnt||0,surveyCnt:e.surveyCnt||0,reportCnt:e.reportCnt||0,groupCnt:e.groupCnt||0,externalCnt:e.externalCnt||0,liveCnt:e.liveCnt||0}:{}})),r=u((()=>s.chapterLesson?.courseDegreeChapter?.reduce(((e,t)=>e+(t.lessonList?.filter((e=>p.isCompletedLesson(e)))?.length||0)),0)||0)),c=u((()=>s.chapterLesson?.courseDegreeChapter?.reduce(((e,t)=>e+(t.lessonList?.length??0)),0)||0));const l=e=>({[d.VOD]:"ibk-icon-lectureroom-camera",[d.EXTERNAL]:"ibk-icon-lectureroom-tv",[d.LIVE]:"ibk-icon-lectureroom-play",[d.GROUP]:"ibk-icon-lectureroom-intersection",[d.REPORT]:"ibk-icon-lectureroom-book",[d.EXAM]:"ibk-icon-lectureroom-document",[d.SURVEY]:"ibk-icon-lectureroom-chat"}[e]||"ibk-icon-lectureroom-camera"),L=e=>[d.REPORT,d.EXAM,d.SURVEY].includes(e.connKcd)?`${h(e.lssoSttgTs)} - ${h(e.lssoFnshTs)}`:e.connKcd==d.VOD?`${((e.vod?.connLen||0)/60).toFixed(1)} 분`:`${e.lcteTim?e.lcteTim:0} 분`;function h(e){if(!e)return"";return new Date(e).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}return{completedLessonsCount:r,totalLessonsCount:c,getLessonIcon:l,getLessonDuration:L,getLessonStatusStyle:e=>{const t={[g.BEFORE]:{background:"#e4f2ff",color:"#234eaa"},[g.PROGRESS]:{background:"#308af2",color:"#ffffff"},[g.COMPLETED]:{background:"#f3f4f7",color:"#5a5e6c"},[g.SUBMITTED]:{background:"#f3f4f7",color:"#5a5e6c"},[g.NOT_SUBMITTED]:{background:"#fae1df",color:"#ee473d"},[g.UNKNOWN]:{background:"#f3f4f7",color:"#5a5e6c"}};if((null===e.acmlCnfgRto||0===e.acmlCnfgRto)&&[d.EXAM,d.SURVEY,d.REPORT].includes(e.connKcd))return t[g.NOT_SUBMITTED];return t[p.getLessonStatus(e)]},getLessonIconActive:function(e){return`${l(e)}-on`},formatDate:h,openQRCodeModal:function(e){n.currentLesson=e,n.visibleLearnAttendanceQrCodeDialog=!0},contentLabels:{vodCnt:"콘텐츠",examCnt:"평가",surveyCnt:"설문",reportCnt:"과제",groupCnt:"그룹",externalCnt:"외부",liveCnt:"라이브"},contentUnits:{vodCnt:"개",examCnt:"회",surveyCnt:"회",reportCnt:"개",groupCnt:"개",externalCnt:"개",liveCnt:"개"},contentCounts:o,getLessonInfo:function(e){switch(e.connKcd){case d.EXAM:case d.REPORT:const t=L(e);return null==e.courseResult?t:`${t} ${e.courseResult?.acqmScr||0}점`;case d.VOD:case d.SURVEY:case d.GROUP:case d.EXTERNAL:return L(e);default:return""}},isActiveLesson:function(e){return e.edctDsprLssoNo===n.currentLesson?.edctDsprLssoNo},getLessonStatusClass:function(e){return p.getLessonStatus(e)==g.COMPLETED?"text-primary-600":"text-red-500"},getLessonStatus:p.getLessonStatus,moveToNextLesson:function(){null==n.currentLesson?alert("현재 학습중인 컨텐츠가 없습니다."):p.getIns().moveToNextLesson()},readyToStartLesson:async function(o,r){if(null==o||null==r)return await e("차수 또는 직무교육코드가 없습니다."),!1;{let a="Y"==(await n.getCourseStatus({dutyEdctCd:r,edctDsprNo:o})).courseDegreeCheck;if(!a)return e("수강중이 아닙니다."),window.history.back(),!1;try{await n.createLessonSummary({dutyEdctCd:r,edctDsprNo:o})}catch(c){console.error(c),t.moveBack()}return await s.getChapterLesson({edctDsprNo:o,dutyEdctCd:r}),p.isSequencialLearning(s.chapterLesson?.courseDegree)&&p.refineForSequentialLearning(s.chapterLesson?.courseDegreeChapter||[]),a}},onLessonMounted:function(){let e=null;n.currentLesson?.connKcd==d.LIVE&&(e=100),n.currentLesson?.connKcd==d.VOD||p.getIns().sendSummary(e,100)},onLearningExit:function(){n.currentLesson=null,n.lastLesson=null,n.lastLessonParam=null},onLearningEntered:function(){}}}var g=(e=>(e.BEFORE="진행전",e.PROGRESS="진행중",e.COMPLETED="학습종료",e.SUBMITTED="제출완료",e.NOT_SUBMITTED="미제출",e.UNKNOWN="알수없음",e))(g||{});class p{static isSequencialLearning(e){return"S"==e?.pgrsMthdVl}static instance=null;myLearnStore=a();learningStore=i();edctDsprLssoNo=null;edctDsprNo=null;dutyEdctCd=null;constructor(){}static getIns(){return p.instance||(p.instance=new p),p.instance}async init(){const e=s(),{edctDsprLssoNo:t,edctDsprNo:n,dutyEdctCd:o}=e.query;this.edctDsprLssoNo=t,this.edctDsprNo=n,this.dutyEdctCd=o;const r=L();await r.readyToStartLesson(this.edctDsprNo,this.dutyEdctCd),l((()=>this.myLearnStore.chapterLesson?.courseDegreeChapter),(e=>{p.isSequencialLearning(this.myLearnStore.chapterLesson?.courseDegree)&&p.refineForSequentialLearning(e||[])}),{immediate:!0,deep:!0})}makeLessonStartPercentage(){const e=p.getIns().getLesson(this.edctDsprLssoNo);e&&(e.acmlCnfgRto=1)}makeLesson100Percentage(){const e=p.getIns().getLesson(this.edctDsprLssoNo);e&&(e.acmlCnfgRto=100),this.learningStore.visibleMenu=!0}getChapter(e){const t=this.myLearnStore.chapterLesson?.courseDegreeChapter?.find((t=>t.lessonList?.some((t=>t.edctDsprLssoNo==e))));return t||null}getLesson(e){const t=this.getChapter(e);return t&&t?.lessonList?.find((t=>t.edctDsprLssoNo==e))||null}static isCompletedLesson(e){return 100==e.acmlCnfgRto}static getLessonStatus(e){let t="";return t="Y"==e.courseResult?.ctcrYn?"학습종료":null===e.acmlCnfgRto||0===e.acmlCnfgRto?"진행전":e.acmlCnfgRto<100?"진행중":100==e.acmlCnfgRto?"학습종료":"알수없음",t}static isLessonCompleted(e){return null!=e&&"학습종료"==this.getLessonStatus(e)}static getLessonStatusName(e){let t=!1;[d.EXAM,d.SURVEY,d.REPORT].includes(e.connKcd)&&(t=!0);const s=this.getLessonStatus(e);return"진행전"==s?t?"미제출":"진행전":"진행중"==s?e.acmlCnfgRto+"%":"학습종료"==s?t?"제출완료":"학습종료":"알수없음"}static getLessonTypeName(e){return e?e===d.VOD?"VOD":e===d.EXTERNAL?"외부CP및링크":e:"-"}getEdctCdAndNo(){const e=s();return{dutyEdctCd:this.dutyEdctCd??e.query.dutyEdctCd,edctDsprNo:this.edctDsprNo??e.query.edctDsprNo}}getQrAttendanceUrl(){const t=n().userInfo;if(o(t))return e("로그인 상태가 아닙니다.</br>로그인 후 출석을 진행해주세요."),"";return`${window.location.origin}/myLearn/studyRoom/learning/attendance?${new URLSearchParams({dutyEdctCd:this.getEdctCdAndNo().dutyEdctCd,edctDsprNo:this.getEdctCdAndNo().edctDsprNo,edctDsprChpaNo:this.learningStore.currentLesson?.edctDsprChpaNo,edctDsprLssoNo:this.learningStore.currentLesson?.edctDsprLssoNo,userId:t?.userId}).toString()}`}openExternalLink(){window.open(this.learningStore.currentLesson?.extlCrtcUrlAdr,"_blank")}moveToStudyRoom(){this.learningStore.currentLesson=null,this.learningStore.visibleMenu=!1;r().replace({path:"/myLearn/studyRoom",query:{dutyEdctCd:this.getEdctCdAndNo().dutyEdctCd,edctDsprNo:this.getEdctCdAndNo().edctDsprNo}})}moveToMyLearnList(){r().push({path:"/myLearn"})}async showAlertIfNotTodayInLessonDateRange(s){const n=t.currentDate(),o=c(s.lssoSttgTs),r=c(s.lssoFnshTs);return s.connKcd==d.EXTERNAL||(n.isBefore(o)?(await e(`해당 레슨이 시작 전입니다.</br>시작 시간은 ${o.format("YYYY-MM-DD HH:mm")} 입니다.`),!1):!n.isAfter(r)||(await e(`해당 레슨이 종료 되었습니다.</br>종료 시간은 ${r.format("YYYY-MM-DD HH:mm")} 입니다.`),!1))}async moveToLesson(t,s,n,c=!0){let a=this.learningStore.lastLesson;null!=this.learningStore.lastLessonParam&&this.learningStore.lastLessonParam.edctDsprNo==s&&this.learningStore.lastLessonParam.dutyEdctCd==t||(a=await this.learningStore.getLastLesson({edctDsprNo:s,dutyEdctCd:t}));let i=!1;null==n&&0==o(a)&&(i=!0);let u=this.getLesson(n);if(u?.connKcd==d.GROUP)return void e("오프라인 집합교육입니다");this.edctDsprLssoNo=n,this.edctDsprLssoNo?this.learningStore.currentLesson=this.getLesson(this.edctDsprLssoNo):(this.learningStore.currentLesson=i?this.getLesson(a.lastLrngLssoNo):this.myLearnStore.chapterLesson?.courseDegreeChapter?.[0]?.lessonList?.[0],this.edctDsprLssoNo=this.learningStore.currentLesson?.edctDsprLssoNo),null==u&&(u=this.getLesson(this.edctDsprLssoNo));if(0==await this.showAlertIfNotTodayInLessonDateRange(u))return;const l=r(),L={dutyEdctCd:t,edctDsprNo:s,edctDsprLssoNo:this.edctDsprLssoNo};l.push({path:"/myLearn/studyRoom/learning",query:L})}static refineForSequentialLearning(e){let t=null;e.forEach(((e,s)=>{e.lessonList?.forEach(((e,n)=>{if(0===s&&0===n)return e.isDisabled=!1,void(t=e);if(t){const s=[d.EXTERNAL,d.GROUP,d.LIVE].includes(t.connKcd),n=100===t.acmlCnfgRto,o=!0===t.isDisabled;e.isDisabled=!(s&&!o||n)}t=e}))})),console.count("Sequential learning refined:")}moveToNextLesson(){const e=r(),t=this.learningStore.currentLesson?.edctDsprLssoNo;if(void 0===t)return void alert("현재 학습중인 컨텐츠가 없습니다.");const s=this.getChapter(t);if(!s||!s.lessonList)return void alert("현재 챕터가 없습니다.");const n=s.lessonList.findIndex((e=>e.edctDsprLssoNo===t));if(-1===n)return void alert("현재 컨텐츠가 없습니다.");let o=s.lessonList[n+1],c=s;if(!o){const e=this.myLearnStore.chapterLesson?.courseDegreeChapter||[],t=e.findIndex((e=>e.edctDsprChpaNo===s.edctDsprChpaNo));-1!==t&&t<e.length-1&&(c=e[t+1],o=c.lessonList?.[0])}o?(e.push({path:"/myLearn/studyRoom/learning",query:{dutyEdctCd:this.getEdctCdAndNo().dutyEdctCd,edctDsprNo:this.getEdctCdAndNo().edctDsprNo,edctDsprLssoNo:o.edctDsprLssoNo}}),this.learningStore.currentLesson=o):this.moveToStudyRoom()}sendSummary(e,t){if(this.learningStore.currentLesson){let s={dutyEdctCd:this.learningStore.currentLesson?.dutyEdctCd,edctDsprNo:this.learningStore.currentLesson?.edctDsprNo,edctDsprLssoNo:this.learningStore.currentLesson?.edctDsprLssoNo,edctDsprChpaNo:this.learningStore.currentLesson?.edctDsprChpaNo,currentAcmlPictLen:e,currentValue:t};this.learningStore.currentLesson.connKcd==d.VOD&&this.learningStore.updateLessonSummary(s);if(100==this.learningStore.currentLesson.acmlCnfgRto)this.learningStore.sendLastProgress(s);else{const e=i();parseInt(e.lastLesson?.lastVl??"0")<t&&this.learningStore.sendLastProgress(s)}}}}export{p as M,L as u};
